(window.webpackJsonp=window.webpackJsonp||[]).push([[15],{357:function(s,n,a){"use strict";a.r(n);var t=a(40),e=Object(t.a)({},(function(){var s=this,n=s.$createElement,a=s._self._c||n;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"数据流"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#数据流"}},[s._v("#")]),s._v(" 数据流")]),s._v(" "),a("p",[s._v("数据流的简化方案基于 redux, redux-saga")]),s._v(" "),a("h2",{attrs:{id:"传统方案"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#传统方案"}},[s._v("#")]),s._v(" 传统方案")]),s._v(" "),a("p",[s._v("通常我们定义一系列的 action 函数, reducer 函数, 然后定义一些 type 常量, action 函数一个 FSA 对象, 通过 type 来定位处理的 reducer 方法, 如果用 redux-saga 来处理副作用, 还会有一些 saga 函数, 下面是一个典型的目录结构")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("|-----acttions  // action函数\n|-----reducers  // reducers 状态改变处理\n|-----sagas     // 副作用处理\n|-----store\n|--------createStore.js  // 生成store\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("当然你也可以根据业务模块划分, 甚至写在同一个文件中, 但是整个过程仍然显得繁琐, 而实际上我们经常改动的副作用处理和状态改变处理.")]),s._v(" "),a("h2",{attrs:{id:"简化方案"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#简化方案"}},[s._v("#")]),s._v(" 简化方案")]),s._v(" "),a("p",[s._v("从上面可以看出 action 和 reducer, sagas 函数几乎是一一对应的, 我们可以省去 action 函数的定义, 使用方法如下:")]),s._v(" "),a("h4",{attrs:{id:"定义-modules"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#定义-modules"}},[s._v("#")]),s._v(" 定义 modules")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("export default {\n  name: 'posts',\n  state: {\n    list: []\n  },\n  mutations: {\n    update: (state, { payload: { list } }) => (state.list = list)\n  },\n  sagas: {\n    *fetch({ call, put, actions: { update } }, { payload: { page } }) {\n      try {\n        const { data } = yield call(fetchPost, { page })\n        yield put(\n          update({\n            list: data\n          })\n        )\n      } catch (err) {\n        console.log(err)\n      }\n    }\n  }\n}\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br")])]),a("ul",[a("li",[a("code",[s._v("name")]),s._v(" 每个 modules 的命名空间")]),s._v(" "),a("li",[a("code",[s._v("state")]),s._v(" 初始 state")]),s._v(" "),a("li",[a("code",[s._v("mutations")]),s._v(" 对应 reducer 状态处理函数, 由于内置 immer 这里称为 mutations")]),s._v(" "),a("li",[a("code",[s._v("sagas")]),s._v(" 副作用处理函数\n上面省略了 actions 函数, 但经过 qilin 处理后, 最终会生成 actions")])]),s._v(" "),a("h4",{attrs:{id:"添加模块-生成-store"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#添加模块-生成-store"}},[s._v("#")]),s._v(" 添加模块, 生成 store")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("import qilin from 'qilin'\nimport posts from './posts'\nconst Qilin = new qilin()\n\nQilin.addModule(posts)\n\nconst store = Qilin.createStore()\n\nexport default store\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("p",[s._v("初始 qilin, 模块经过处理, 生成 store")]),s._v(" "),a("h4",{attrs:{id:"class-组件使用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#class-组件使用"}},[s._v("#")]),s._v(" class 组件使用")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("import { connect } from 'react-redux'\nimport { Qilin } from '../modules'\n\nclass TestsComponent extends React.Component<TestsProps> {\n  render() {\n    const {\n      list,\n      posts: { fetch }\n    } = this.props\n\n    return (\n      <div>\n        <button onClick={() => fetch({ page: 1 })}>第一页(Component)</button>\n        <button onClick={() => fetch({ page: 2 })}>第二页(Component)</button>\n        {list.map(item => (\n          <div key={item.id}>{item.title}</div>\n        ))}\n      </div>\n    )\n  }\n}\n\nconst mapStateToProps = (state: any) => {\n  return {\n    list: state.posts.list\n  }\n}\n\nexport default connect(mapStateToProps, Qilin.mapDispatchToProps)(TestsComponent)\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br")])]),a("ul",[a("li",[a("code",[s._v("Qilin.mapDispatchToProps")]),s._v(" 生成 store 后, qilin 会生成 mapDispatchToProps, 传入 connect, 则在 props 中可以调用每一个 actions 方法")])]),s._v(" "),a("h5",{attrs:{id:"hooks-组件调用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#hooks-组件调用"}},[s._v("#")]),s._v(" hooks 组件调用")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("import { useSelector } from 'react-redux'\nimport { Qilin } from '../modules'\nconst { fetch } = Qilin.getAction('posts')\n\nconst HooksTests = () => {\n  const {list} = useSelector((state: any) => state.posts)\n  return (\n    <div>\n      <button onClick={() => fetch({ page: 3 })}>第三页Hooks</button>\n      <button onClick={() => fetch({ page: 4 })}>第四页Hooks</button>\n      {list.map(item => (\n        <div key={item.id}>{item.title}</div>\n      ))}\n    </div>\n  )\n}\n\nexport default HooksTests\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br")])]),a("ul",[a("li",[a("code",[s._v("Qilin.getAction")]),s._v(" 生成 store 后, 可通过 getAction 获取每个模块的 action 函数")])]),s._v(" "),a("p",[s._v("这些 action 函数都经过了 bindActionCreators 包装, 省去了 dispatch({type: ...})的过程")])])}),[],!1,null,null,null);n.default=e.exports}}]);